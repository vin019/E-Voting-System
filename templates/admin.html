<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>E-Voting Admin Dashboard</title>
    <link rel="stylesheet" href="http://127.0.0.1:5000/static/CSS/admin.css">
    <link rel="canonical" href="https://getbootstrap.com/docs/5.3/examples/navbars-offcanvas/">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@3">
    <link href="http://127.0.0.1:5000/static/assets/dist/css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
    <!-- Navigation Bar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container-fluid">
            <a class="navbar-brand" href="{{ url_for('index') }}">E-Voting System</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('vote') }}">Vote</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('about') }}">About</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('logout') }}">Logout</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('admin') }}">Admin</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('dashboard') }}">Edit Users</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="admin-container">
        <header class="admin-header">
            <h1>Admin Dashboard</h1>
            <p>Manage candidates and oversee the e-voting process.</p>
        </header>

        <h2>Add New Candidate</h2>
        <form action="{{ url_for('add_candidate') }}" method="POST" style="max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 8px; background-color: #f9f9f9; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);">
            <div style="margin-bottom: 15px;">
                <label for="candidateName" style="font-weight: bold;">Candidate Name:</label>
                <input type="text" id="candidateName" name="candidateName" required style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label for="candidatePosition" style="font-weight: bold;">Position:</label>
                <input type="text" id="candidatePosition" name="candidatePosition" required style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            
            <h3 style="margin-top: 20px;">Add New Election (Optional)</h3>
            <div style="margin-bottom: 15px;">
                <label for="electionId" style="font-weight: bold;">Election ID:</label>
                <input type="text" id="electionId" name="electionId" placeholder="Enter new election ID (if applicable)" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label for="electionName" style="font-weight: bold;">Election Name:</label>
                <input type="text" id="electionName" name="electionName" placeholder="Enter election name (if applicable)" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label for="startDate" style="font-weight: bold;">Start Date:</label>
                <input type="date" id="startDate" name="startDate" placeholder="Select start date (if applicable)" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </div>
            <div style="margin-bottom: 15px;">
                <label for="endDate" style="font-weight: bold;">End Date:</label>
                <input type="date" id="endDate" name="endDate" placeholder="Select end date (if applicable)" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
            </div>  
        
            <div style="margin-bottom: 15px;">
                <label for="existingElectionId" style="font-weight: bold;">Or select an existing election ID:</label>
                <select id="existingElectionId" name="existingElectionId" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px;">
                    <option value="">Select an existing election ID</option>
                    {% for election in elections %}
                        <option value="{{ election.id, election.name }}">{{ election.id, election.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <button type="submit" style="width: 100%; padding: 10px; background-color: #007bff; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer;">Add Candidate</button>
        </form>
        
        <h2>Candidates</h2>
        <div class="candidates-list">
            {% for candidate in candidates %}
            <div class="candidate" id="candidate{{ candidate.id }}" style="margin-bottom: 20px; padding: 10px; border: 1px solid #ccc; border-radius: 8px; background-color: #f9f9f9;">
                <h3>{{ candidate.name }}</h3>
                <p>Position: {{ candidate.position }}</p>
                <p>Election: {{ candidate.election_name if candidate.election_name else 'Not Assigned' }}</p>
                <button type="button" onclick="openEditModal({{ candidate.id }}, '{{ candidate.name }}', '{{ candidate.position }}')" style="background-color:rgb(220, 181, 53); border-radius: 4px; padding: 5px 10px; cursor: pointer;">Edit</button>
                <button type="button" onclick="deleteCandidate({{ candidate.id }})" style="background-color: #dc3545; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer;">Delete</button>
            </div>
            {% endfor %}
        </div>
    </div>

    <script>
        function openEditModal(id, name, position) {
            // Implement the modal opening logic here
        }
        function deleteCandidate(candidateId) {
            if (confirm('Are you sure you want to delete this candidate?')) {
                // Make an AJAX request to delete the candidate
                fetch(`/delete_candidate/${candidateId}`, {
                    method: 'DELETE'
                })
                .then(response => {
                    if (response.ok) {
                        document.getElementById(`candidate${candidateId}`).remove();
                        alert('Candidate deleted successfully.');
                    } else {
                        alert('Error deleting candidate.');
                    }
                });
            }
        }
    </script>
</body>
</html>